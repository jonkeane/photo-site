{{/* TODO: this could probably use .Params directly rather than going through site.Data.flickr.photosets */}}
{{ $fid := .Params.flickr_id | string }}
{{ $album := .Params.flickr_album }}
{{ $slug := .Params.gallery_slug }}
{{ $ps := index site.Data.flickr.photosets $slug }}
{{ if not $ps }}
  <section class="page">
  <p>Metadata not found for photoset (photoset key: {{ $slug }}).</p>
  </section>
{{ else }}
  {{/* Find photo object by ID */}}
  {{ $photos := $ps.photoset.photo }}
  {{ $filtered := where $photos "id" $fid }}
  {{ $photo := index $filtered 0 }}
  {{ if not $photo }}
    <section class="page">
    <p>Photo {{ $fid }} not in dataset.</p>
    </section>
  {{ else }}
  <section class="page">
  <a href=".." class="button", id="galleryBackBtn">back to gallery</a>
  <article class="photo-single">
    {{/* TODO: devicce-dependent sizing? */}}
    {{ $url := or $photo.url_h $photo.url_k $photo.url_l $photo.url_c $photo.url_z $photo.url_m $photo.url_o $photo.url_sq }}
    <figure>
      <img src="{{ $url }}" alt="{{ or $photo.title (printf "Photo %s" $fid) }}" loading="eager"/>
      {{ if $photo.description._content }}
      <figcaption>{{ $photo.description._content | safeHTML }}</figcaption>
      {{ end }}
      {{ if $photo.tags }}
      <div id="terms" class="flex flex-row flex-wrap items-center">
        {{ range $tag := $photo.tags }}
          <span><a class="button primary tag" href="/tags/{{ $tag | urlize }}">{{ $tag }}</a></span>
        {{ end }}
      </div>
      {{ end }}
    </figure>
    {{ partial "photo/exif" (dict "Photo" $photo) }}
    {{ partial "photo/nav" (dict "Page" . "Photos" $photos "Current" $photo) }}
    <header class="major">
      <h1>{{ or .Title $photo.title }}</h1>
    </header>
  </article>
  </section>
  {{ end }}
{{ end }}